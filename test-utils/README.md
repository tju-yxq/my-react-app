# 语音AI前端自动化测试工具

这是一个为语音AI项目前端设计的自动化测试工具包，可以帮助非开发人员轻松地测试和调试前端语音交互功能。

## 功能特点

- 自动化测试语音识别和语音合成功能
- 模拟用户语音输入和交互
- 模拟API响应，无需依赖后端
- 实时查看测试过程和结果
- 详细的日志记录和错误追踪
- 浏览器兼容性检测
- 友好的用户界面，方便非开发人员使用

## 快速开始

### 启动测试环境

在项目根目录下运行以下命令启动测试环境：

```bash
cd frontend
./run-tests.sh
```

这将启动前端开发服务器并自动打开测试页面。如果服务器已经在运行，将只打开测试页面。

### 使用测试界面

测试页面包含以下几个部分：

1. **测试场景** - 选择要运行的测试场景
   - 基础语音识别测试
   - 错误处理测试
   - 直接回复测试
   - 用户确认/取消测试

2. **浏览器环境信息** - 显示当前浏览器的信息和API支持状况

3. **测试日志** - 实时显示测试过程中的日志信息

4. **测试运行器** - 一个浮动窗口，显示当前测试的执行状态和步骤

### 运行测试

1. 在测试场景列表中选择一个测试
2. 点击"运行选中测试"按钮
3. 观察测试运行过程和结果
4. 查看测试日志了解详细信息

### 清理测试环境

测试完成后，可以运行以下命令清理测试环境：

```bash
./cleanup-tests.sh
```

这将停止测试服务器，清理测试日志，并恢复环境变量。

## 测试场景说明

### 基础语音识别测试

测试基本的语音识别和处理流程，包含以下步骤：
- 点击语音按钮
- 模拟用户说话
- 检查状态栏更新
- 模拟后端API响应
- 检查确认文本
- 模拟用户确认
- 验证结果显示

### 错误处理测试

测试各种错误情况的处理，包括：
- 语音识别错误
- API请求错误
- 语音合成错误
- 权限拒绝错误

### 直接回复测试

测试不需要用户确认的直接回复场景，例如：
- 查询时间
- 简单问答
- 系统状态查询

### 用户确认/取消测试

测试需要用户确认的操作场景，包括：
- 确认流程
- 取消流程
- 重试流程

## 常见问题

### 麦克风无法启动

如果测试过程中出现麦克风无法启动的问题，可能是权限问题，请确保：

1. 浏览器有麦克风访问权限
2. 系统设置允许浏览器访问麦克风
3. 没有其他应用占用麦克风

### API模拟不起作用

如果API模拟不起作用，可能是因为：

1. 测试环境未正确初始化
2. 前端代码中的API调用方式与模拟不匹配
3. 网络请求被其他拦截器拦截

请检查控制台日志获取更多信息。

### 测试运行器无法显示

如果测试运行器窗口没有显示，可能是因为：

1. CSS样式冲突
2. 浏览器兼容性问题
3. JavaScript错误

尝试使用Chrome浏览器运行测试，并检查控制台是否有错误信息。

## 开发者文档

如果你需要扩展测试工具或添加新的测试场景，请参考以下文件：

- `src/tests/AutomatedTest.js` - 测试场景定义
- `src/tests/TestRunner.js` - 测试运行器组件
- `src/tests/TestPage.js` - 测试页面组件
- `test-utils/FixedMockSpeech.js` - 语音API模拟工具
- `test-utils/Logger.js` - 日志工具

### 添加新的测试场景

在 `src/tests/AutomatedTest.js` 文件中添加新的测试场景：

```javascript
export const newTestScenario = {
  name: "新测试场景",
  description: "这是一个新的测试场景",
  steps: [
    {
      name: "步骤1",
      // 步骤定义...
    },
    // 更多步骤...
  ]
};

// 将新测试添加到导出的数组中
export default [
  basicSpeechTest,
  errorHandlingTest,
  directReplyTest,
  userConfirmationTest,
  newTestScenario  // 添加新测试
];
```

## 注意事项

1. 测试工具使用Web Speech API模拟语音交互，这个API在不同浏览器中的实现可能有差异
2. 推荐使用Google Chrome浏览器运行测试，它对Web Speech API的支持最完善
3. 某些测试可能需要真实的麦克风权限，请确保授予权限
4. 测试过程中可能会播放声音，请注意调整音量 